<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> 
circle {stroke:black;fill-opacity: 0.8} 
div.tooltip {	
    position: absolute;			
    text-align: left;			
    width: 150px;					
    height: 100px;					
    padding: 2px;				
    font-family: Sans-serif;
    font: size 12px;
    background: lightsteelblue;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}
td {
    font-size: 12px;
}
</style>
<body onload='init()'>
<svg width=1000 height=1000>
</svg>
<script>
async function init() {
    const data = await d3.csv('https://alanflanders.github.io/SpotifyStreamAnalysis2019/CountryTopAggregateData.csv');

    var margin = {top: 100, right: 100, bottom: 100, left: 100};
    svg = d3.select("svg");
    svgWidth = parseInt(svg.style("width"));
    svgHeight = parseInt(svg.style("height"));

    // bar chart
    var width = svgWidth - margin.left - margin.right;
    var height = svgHeight - margin.top - margin.bottom;

    var x = d3.scaleLinear()
    .domain([-1,40])
    .range([0,width]);

    var y = d3.scaleLinear()
    .domain([10,110])
    .range([height,0]);

    var r = d3.scaleLinear()
    .domain([0,135])
    .range([1,(16/1000)*width]);

    g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    g.selectAll("circle")  
    .data(data)
    .enter().append("circle")
    .attr("cx", function(d,i){return x(d.AvgDaysToTop10);})
    .attr("cy", function(d,i){return y(d.AvgDaysInTop10);})
    .attr("r", function(d,i){return r(d.TrackCount);})
    .on("mouseover", function(d) {		
        div.transition()		
            .duration(200)		
            .style("opacity", .9);		
        div	.html("<table>" +
                "<tr><td><b>" + d.Country + "</b></td></tr>" +
                "<tr><td>Tracks in top ten:" + "</td><td>" + d.TrackCount + "</td></tr>" +
                "<tr><td>Avg. days in top ten:" + "</td><td>" + d.AvgDaysInTop10 + "</td></tr>" +
                "<tr><td>Avg. days to top ten:" + "</td><td>" + d.AvgDaysToTop10 + "</td></tr>" +
                "<tr><td>Total streams:" + "</td><td>" + parseInt(d.Streams/1000000) + "M</td></tr>" +
                "</table>")	
            .style("left", (d3.event.pageX) + "px")		
            .style("top", (d3.event.pageY - 28) + "px");	
        })					
    .on("mouseout", function(d) {		
        div.transition()		
            .duration(500)		
            .style("opacity", 0);	
        });


    // Define the div for the tooltip
    var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);

    // Axis
    svg.append("g")
    .attr("transform","translate("+margin.left+","+margin.top+")")
    .call(d3.axisLeft(y).tickValues([20,30,40,50,60,70,80,90,100,110]).tickFormat(d3.format("~s")));

    svg.append("g")
    .attr("transform","translate("+margin.left + "," + (height + margin.top) + ")")
    .call(d3.axisBottom(x).tickValues([0,10,20,30,40]).tickFormat(d3.format("~s")));
}

</script>
</body>
</html>